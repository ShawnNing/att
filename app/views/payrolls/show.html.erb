<p id="notice"><%= notice %></p>
<div ng-app="anApp">
  <div ng-controller="EmployeesCtrl">
    <h2>{{employees.length}}</h2>
    <table class="table table-striped table-bordered table-condensed">
      <tr>
        <th><button ng-click="sortBy('num');">No</button></th>
        <th><button ng-click="sortBy('sin');">SIN</button></th>
        <th><button ng-click="sortBy('name');">Name</button></th>
        <th><button ng-click="sortBy('note');">Note</button></th>
        <th>Action</th>
      </tr>
      <tr ng-repeat="employee in payroll_employees | orderBy:predicate" ng-class="employee.class_name()">
        <td>{{employee.num}}</td>
        <td>{{employee.sin}}</td>
        <td>{{employee.name}}</td>
        <td><input type="text" name="note" ng-model="employee.note"></td>
        <td><button ng-click="removeFromPayroll(employee);">Move Down</button></td>
      </tr>
    </table>
    
    <table class="table table-striped table-bordered table-condensed">
      <tr>
        <th><button ng-click="sortBy('num');">No</button></th>
        <th><button ng-click="sortBy('sin');">SIN</button></th>
        <th><button ng-click="sortBy('name');">Name</button></th>
        <th><button ng-click="sortBy('note');">Note</button></th>
        <th>Action</th>
      </tr>
      <tr ng-repeat="employee in employees | orderBy:predicate" ng-class="employee.class_name()">
        <td>{{employee.num}}</td>
        <td>{{employee.sin}}</td>
        <td>{{employee.name}}</td>
        <td>{{employee.work_hours}}</td>
        <td><input type="text" name="note" ng-model="employee.note"></td>
        <td><button ng-click="addToPayroll(employee);">Move Up</button></td>
      </tr>
    </table>
    
  </div>
</div>

<script type="text/javascript">
var anApp = angular.module('anApp', ['ui.bootstrap']);

anApp.controller('EmployeesCtrl', function EmployeesCtrl($scope, $http) {
  $http.get('<%=employees_path(:with_work_hours=>true, :format=>'json')%>').success(function(data) {
    $scope.employees = data;
    data.forEach(function(employee) {
      employee.note = '';
    });
  });
  
  $http.get('<%=payroll_employees_path(@payroll, :format=>'json')%>').success(function(data) {
    $scope.payroll_employees = data;
  });
  
  $scope.addToPayroll = function(employee) {
    $scope.payroll_employees.push(employee);
    $scope.employees.splice($scope.employees.indexOf(employee), 1);
  };
  
  $scope.removeFromPayroll = function(employee) {
    $scope.employees.push(employee);
    $scope.payroll_employees.splice($scope.payroll_employees.indexOf(employee), 1);
  };
  
  $scope.sortBy = function(field){
    if ($scope.predicate == field) $scope.predicate = '-'+field;
    else $scope.predicate = field;
  }
  
  $scope.predicate = '-num';

});
</script>
